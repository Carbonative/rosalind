sudo: required

dist: trusty

language: node_js

node_js:
  - '4.4.4'

services:
  - docker

matrix:
  fast_finish: true

install:
  - chmod +x ci.sh && ./ci.sh install

env:
  global:
    - DOCKER_COMPOSE_VERSION=1.5.2
    - ROOT_URL=http://0.0.0.0:3000/

  matrix:
    - CMD=build
    - CMD=test   OS='Windows 10'   BROWSER='Chrome:50.0'

script: ./ci.sh $CMD

after_script:
  - echo leader=$BUILD_LEADER status=$BUILD_AGGREGATE_STATUS

after_success:
  - python travis_after_all.py
  - export $(cat .to_export_back)
  - |
      if [ "$BUILD_LEADER" = "YES" ]; then
        if [ "$BUILD_AGGREGATE_STATUS" = "others_succeeded" ]; then
          echo "All jobs succeeded! PUBLISHING..."
        else
          echo "Some jobs failed"
        fi
      fi

after_failure:
  - python travis_after_all.py
  - export $(cat .to_export_back)
  - |
      if [ "$BUILD_LEADER" = "YES" ]; then
        if [ "$BUILD_AGGREGATE_STATUS" = "others_failed" ]; then
          echo "All jobs failed"
        else
          echo "Some jobs failed"
        fi
      fi

addons:
  sauce_connect: true
